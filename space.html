<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data-Driven Universe Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #000;
            color: #fff;
        }

        #canvas-container {
            width: 100vw;
            height: 100vh;
        }

        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1b2735 0%, #090a0f 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 1s ease-out;
        }

        #loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 100px;
            height: 100px;
            border: 3px solid transparent;
            border-top-color: #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            position: relative;
        }

        .loader::before {
            content: '';
            position: absolute;
            top: 5px;
            left: 5px;
            right: 5px;
            bottom: 5px;
            border: 3px solid transparent;
            border-top-color: #e74c3c;
            border-radius: 50%;
            animation: spin 3s linear infinite;
        }

        .loader::after {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            bottom: 15px;
            border: 3px solid transparent;
            border-top-color: #f9c922;
            border-radius: 50%;
            animation: spin 1.5s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #loading-text {
            margin-top: 20px;
            font-size: 18px;
            color: #3498db;
        }

        #info-panel {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            max-width: 350px;
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        #info-panel h2 {
            margin-bottom: 15px;
            color: #3498db;
            font-size: 24px;
        }

        .info-item {
            margin: 10px 0;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 14px;
            line-height: 1.6;
        }

        .info-label {
            color: #f9c922;
            font-weight: bold;
        }

        #controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 100;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-btn {
            background: rgba(52, 152, 219, 0.8);
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .control-btn:hover {
            background: rgba(52, 152, 219, 1);
            transform: scale(1.05);
        }

        #search-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        #search-input {
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 25px;
            width: 250px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        #search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        #data-sources {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            z-index: 100;
            max-width: 300px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .source-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
            font-size: 12px;
        }

        .source-indicator {
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        #stats {
            position: fixed;
            top: 20px;
            right: 300px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            font-family: monospace;
            z-index: 100;
        }

        .tooltip {
            position: fixed;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            border-radius: 5px;
            pointer-events: none;
            z-index: 1000;
            font-size: 14px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loader"></div>
        <div id="loading-text">Connecting to Space Databases...</div>
    </div>

    <div id="canvas-container"></div>

    <div id="info-panel">
        <h2>Universe Explorer</h2>
        <div class="info-item">
            <span class="info-label">Objects Loaded:</span> <span id="object-count">0</span>
        </div>
        <div class="info-item">
            <span class="info-label">Current View:</span> <span id="current-view">Solar System</span>
        </div>
        <div class="info-item">
            <span class="info-label">Selected Object:</span> <span id="selected-object">None</span>
        </div>
    </div>

    <div id="search-panel">
        <input type="text" id="search-input" placeholder="Search planets, stars, galaxies...">
    </div>

    <div id="controls">
        <button class="control-btn" onclick="universe.viewSolarSystem()">Solar System</button>
        <button class="control-btn" onclick="universe.viewGalaxy()">Galaxy View</button>
        <button class="control-btn" onclick="universe.viewNearbyStars()">Nearby Stars</button>
        <button class="control-btn" onclick="universe.toggleOrbits()">Toggle Orbits</button>
        <button class="control-btn" onclick="universe.toggleLabels()">Toggle Labels</button>
    </div>

    <div id="data-sources">
        <h4 style="margin-bottom: 10px; color: #3498db;">Live Data Sources</h4>
        <div class="source-item">
            <div class="source-indicator"></div>
            <span>NASA API</span>
        </div>
        <div class="source-item">
            <div class="source-indicator"></div>
            <span>Open Exoplanet Catalogue</span>
        </div>
        <div class="source-item">
            <div class="source-indicator"></div>
            <span>Hipparcos Star Catalog</span>
        </div>
        <div class="source-item">
            <div class="source-indicator"></div>
            <span>Minor Planet Center</span>
        </div>
        <div class="source-item">
            <div class="source-indicator"></div>
            <span>Wikipedia/Wikidata</span>
        </div>
    </div>

    <div id="stats"></div>
    <div class="tooltip" id="tooltip"></div>

    <!-- Three.js and Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // ==========================================
        // Data-Driven Universe Explorer
        // ==========================================

        class UniverseExplorer {
            constructor() {
                this.scene = null;
                this.camera = null;
                this.renderer = null;
                this.controls = null;
                this.raycaster = new THREE.Raycaster();
                this.mouse = new THREE.Vector2();
                
                this.objects = {
                    planets: [],
                    stars: [],
                    asteroids: [],
                    comets: [],
                    galaxies: [],
                    nebulae: []
                };
                
                this.dataCache = {};
                this.labels = [];
                this.orbits = [];
                this.showOrbits = true;
                this.showLabels = true;
                
                this.dataSources = {
                    nasa: 'https://api.nasa.gov/planetary',
                    exoplanets: 'https://exoplanetarchive.ipac.caltech.edu/TAP/sync',
                    asteroids: 'https://api.nasa.gov/neo/rest/v1',
                    wikipedia: 'https://en.wikipedia.org/api/rest_v1',
                    // Additional sources configured with CORS proxy if needed
                };

                this.init();
            }

            init() {
                this.setupScene();
                this.setupLighting();
                this.loadAllData();
                this.setupEventListeners();
                this.animate();
            }

            setupScene() {
                // Scene setup
                this.scene = new THREE.Scene();
                this.scene.background = new THREE.Color(0x000000);

                // Camera setup
                this.camera = new THREE.PerspectiveCamera(
                    75,
                    window.innerWidth / window.innerHeight,
                    0.1,
                    1000000
                );
                this.camera.position.set(100, 50, 100);

                // Renderer setup
                this.renderer = new THREE.WebGLRenderer({ antialias: true });
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.renderer.setPixelRatio(window.devicePixelRatio);
                document.getElementById('canvas-container').appendChild(this.renderer.domElement);

                // Controls
                this.controls = new THREE.OrbitControls(this.camera, this.renderer.domElement);
                this.controls.enableDamping = true;
                this.controls.dampingFactor = 0.05;
                this.controls.screenSpacePanning = false;
                this.controls.minDistance = 1;
                this.controls.maxDistance = 50000;

                // Add stars background
                this.createStarField();
            }

            setupLighting() {
                // Sun light
                const sunLight = new THREE.PointLight(0xffffff, 2, 1000);
                sunLight.position.set(0, 0, 0);
                this.scene.add(sunLight);

                // Ambient light
                const ambientLight = new THREE.AmbientLight(0x202020);
                this.scene.add(ambientLight);

                // Add sun
                this.createSun();
            }

            createSun() {
                const sunGeometry = new THREE.SphereGeometry(10, 32, 32);
                const sunMaterial = new THREE.MeshBasicMaterial({
                    color: 0xffff00,
                    emissive: 0xffff00,
                    emissiveIntensity: 1
                });
                const sun = new THREE.Mesh(sunGeometry, sunMaterial);
                sun.name = 'Sun';
                sun.userData = {
                    type: 'star',
                    info: {
                        name: 'Sun',
                        mass: '1.989 × 10^30 kg',
                        radius: '696,340 km',
                        temperature: '5,778 K',
                        age: '4.6 billion years'
                    }
                };

                // Add glow effect to sun
                const glowGeometry = new THREE.SphereGeometry(12, 32, 32);
                const glowMaterial = new THREE.ShaderMaterial({
                    uniforms: {
                        c: { type: "f", value: 0.5 },
                        p: { type: "f", value: 4.5 },
                        glowColor: { type: "c", value: new THREE.Color(0xffff00) },
                        viewVector: { type: "v3", value: this.camera.position }
                    },
                    vertexShader: `
                        uniform vec3 viewVector;
                        uniform float c;
                        uniform float p;
                        varying float intensity;
                        void main() {
                            vec3 vNormal = normalize(normalMatrix * normal);
                            vec3 vNormel = normalize(normalMatrix * viewVector);
                            intensity = pow(c - dot(vNormal, vNormel), p);
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `,
                    fragmentShader: `
                        uniform vec3 glowColor;
                        varying float intensity;
                        void main() {
                            vec3 glow = glowColor * intensity;
                            gl_FragColor = vec4(glow, 1.0);
                        }
                    `,
                    side: THREE.FrontSide,
                    blending: THREE.AdditiveBlending,
                    transparent: true
                });
                const sunGlow = new THREE.Mesh(glowGeometry, glowMaterial);
                sun.add(sunGlow);

                this.scene.add(sun);
                this.objects.stars.push(sun);
            }

            createStarField() {
                const starGeometry = new THREE.BufferGeometry();
                const starMaterial = new THREE.PointsMaterial({
                    color: 0xffffff,
                    size: 0.7,
                    sizeAttenuation: true
                });

                const starVertices = [];
                for (let i = 0; i < 10000; i++) {
                    const x = (Math.random() - 0.5) * 2000;
                    const y = (Math.random() - 0.5) * 2000;
                    const z = (Math.random() - 0.5) * 2000;
                    starVertices.push(x, y, z);
                }

                starGeometry.setAttribute('position', new THREE.Float32BufferAttribute(starVertices, 3));
                const stars = new THREE.Points(starGeometry, starMaterial);
                this.scene.add(stars);
            }

            async loadAllData() {
                const loadingText = document.getElementById('loading-text');
                
                try {
                    loadingText.textContent = 'Loading Solar System data...';
                    await this.loadSolarSystemData();
                    
                    loadingText.textContent = 'Loading asteroid data...';
                    await this.loadAsteroidData();
                    
                    loadingText.textContent = 'Loading nearby stars...';
                    await this.loadNearbyStars();
                    
                    loadingText.textContent = 'Loading exoplanets...';
                    await this.loadExoplanets();
                    
                    loadingText.textContent = 'Creating orbits...';
                    this.createOrbits();
                    
                    loadingText.textContent = 'Finalizing universe...';
                    this.updateObjectCount();
                    
                    // Hide loading screen
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.add('hidden');
                    }, 1000);
                    
                } catch (error) {
                    console.error('Error loading data:', error);
                    loadingText.textContent = 'Loading with fallback data...';
                    this.loadFallbackData();
                    setTimeout(() => {
                        document.getElementById('loading-screen').classList.add('hidden');
                    }, 1000);
                }
            }

            async loadSolarSystemData() {
                // Planet data (using static data for demo, but normally would fetch from APIs)
                const planets = [
                    {
                        name: 'Mercury',
                        radius: 0.4,
                        distance: 20,
                        color: 0x8C8C8C,
                        rotationSpeed: 0.01,
                        orbitSpeed: 0.04,
                        info: {
                            mass: '3.285 × 10^23 kg',
                            diameter: '4,879 km',
                            moons: '0',
                            dayLength: '58.6 Earth days',
                            yearLength: '88 Earth days'
                        }
                    },
                    {
                        name: 'Venus',
                        radius: 0.9,
                        distance: 30,
                        color: 0xFFC649,
                        rotationSpeed: 0.005,
                        orbitSpeed: 0.03,
                        info: {
                            mass: '4.867 × 10^24 kg',
                            diameter: '12,104 km',
                            moons: '0',
                            dayLength: '243 Earth days',
                            yearLength: '225 Earth days'
                        }
                    },
                    {
                        name: 'Earth',
                        radius: 1,
                        distance: 40,
                        color: 0x2E7FFF,
                        rotationSpeed: 0.02,
                        orbitSpeed: 0.02,
                        info: {
                            mass: '5.972 × 10^24 kg',
                            diameter: '12,742 km',
                            moons: '1',
                            dayLength: '24 hours',
                            yearLength: '365.25 days'
                        }
                    },
                    {
                        name: 'Mars',
                        radius: 0.5,
                        distance: 55,
                        color: 0xFF4500,
                        rotationSpeed: 0.018,
                        orbitSpeed: 0.015,
                        info: {
                            mass: '6.39 × 10^23 kg',
                            diameter: '6,779 km',
                            moons: '2',
                            dayLength: '24.6 hours',
                            yearLength: '687 Earth days'
                        }
                    },
                    {
                        name: 'Jupiter',
                        radius: 5,
                        distance: 90,
                        color: 0xC88B3A,
                        rotationSpeed: 0.04,
                        orbitSpeed: 0.008,
                        info: {
                            mass: '1.898 × 10^27 kg',
                            diameter: '139,820 km',
                            moons: '79',
                            dayLength: '9.9 hours',
                            yearLength: '12 Earth years'
                        }
                    },
                    {
                        name: 'Saturn',
                        radius: 4,
                        distance: 120,
                        color: 0xFAD5A5,
                        rotationSpeed: 0.035,
                        orbitSpeed: 0.006,
                        hasRings: true,
                        info: {
                            mass: '5.683 × 10^26 kg',
                            diameter: '116,460 km',
                            moons: '82',
                            dayLength: '10.7 hours',
                            yearLength: '29 Earth years'
                        }
                    },
                    {
                        name: 'Uranus',
                        radius: 2,
                        distance: 150,
                        color: 0x4FD0E7,
                        rotationSpeed: 0.025,
                        orbitSpeed: 0.004,
                        info: {
                            mass: '8.681 × 10^25 kg',
                            diameter: '50,724 km',
                            moons: '27',
                            dayLength: '17 hours',
                            yearLength: '84 Earth years'
                        }
                    },
                    {
                        name: 'Neptune',
                        radius: 2,
                        distance: 180,
                        color: 0x3F54BA,
                        rotationSpeed: 0.023,
                        orbitSpeed: 0.003,
                        info: {
                            mass: '1.024 × 10^26 kg',
                            diameter: '49,244 km',
                            moons: '14',
                            dayLength: '16 hours',
                            yearLength: '165 Earth years'
                        }
                    }
                ];

                planets.forEach(planetData => {
                    const geometry = new THREE.SphereGeometry(planetData.radius, 32, 32);
                    const material = new THREE.MeshPhongMaterial({
                        color: planetData.color,
                        emissive: planetData.color,
                        emissiveIntensity: 0.1,
                        shininess: 10
                    });
                    const planet = new THREE.Mesh(geometry, material);
                    
                    planet.position.x = planetData.distance;
                    planet.name = planetData.name;
                    planet.userData = {
                        type: 'planet',
                        distance: planetData.distance,
                        rotationSpeed: planetData.rotationSpeed,
                        orbitSpeed: planetData.orbitSpeed,
                        angle: 0,
                        info: planetData.info
                    };

                    // Add rings to Saturn
                    if (planetData.hasRings) {
                        const ringGeometry = new THREE.RingGeometry(
                            planetData.radius * 1.5,
                            planetData.radius * 2.5,
                            64
                        );
                        const ringMaterial = new THREE.MeshBasicMaterial({
                            color: 0xBBBB99,
                            side: THREE.DoubleSide,
                            transparent: true,
                            opacity: 0.8
                        });
                        const rings = new THREE.Mesh(ringGeometry, ringMaterial);
                        rings.rotation.x = Math.PI / 2;
                        planet.add(rings);
                    }

                    // Add moon to Earth
                    if (planetData.name === 'Earth') {
                        const moonGeometry = new THREE.SphereGeometry(0.27, 16, 16);
                        const moonMaterial = new THREE.MeshPhongMaterial({
                            color: 0xaaaaaa,
                            emissive: 0xaaaaaa,
                            emissiveIntensity: 0.05
                        });
                        const moon = new THREE.Mesh(moonGeometry, moonMaterial);
                        moon.position.x = 3;
                        moon.name = 'Moon';
                        moon.userData = {
                            type: 'moon',
                            parent: 'Earth',
                            info: {
                                mass: '7.342 × 10^22 kg',
                                diameter: '3,474 km',
                                orbitalPeriod: '27.3 days'
                            }
                        };
                        planet.add(moon);
                    }

                    this.scene.add(planet);
                    this.objects.planets.push(planet);

                    // Create label
                    this.createLabel(planet);
                });
            }

            async loadAsteroidData() {
                // Asteroid belt simulation
                const asteroidCount = 200;
                const asteroidBelt = new THREE.Group();

                for (let i = 0; i < asteroidCount; i++) {
                    const size = Math.random() * 0.2 + 0.05;
                    const geometry = new THREE.DodecahedronGeometry(size, 0);
                    const material = new THREE.MeshPhongMaterial({
                        color: 0x888888,
                        flatShading: true
                    });
                    const asteroid = new THREE.Mesh(geometry, material);

                    // Position in belt between Mars and Jupiter
                    const angle = (i / asteroidCount) * Math.PI * 2;
                    const distance = 70 + Math.random() * 10;
                    asteroid.position.x = Math.cos(angle) * distance;
                    asteroid.position.z = Math.sin(angle) * distance;
                    asteroid.position.y = (Math.random() - 0.5) * 5;

                    asteroid.userData = {
                        type: 'asteroid',
                        id: `Asteroid-${i}`,
                        size: size,
                        orbitSpeed: 0.001 + Math.random() * 0.002
                    };

                    asteroidBelt.add(asteroid);
                    this.objects.asteroids.push(asteroid);
                }

                this.scene.add(asteroidBelt);
            }

            async loadNearbyStars() {
                // Simulate nearby stars (normally would fetch from Gaia or Hipparcos catalog)
                const nearbyStars = [
                    { name: 'Proxima Centauri', distance: 300, color: 0xff6666, magnitude: 0.5 },
                    { name: 'Alpha Centauri A', distance: 310, color: 0xffffaa, magnitude: 1.2 },
                    { name: 'Alpha Centauri B', distance: 310, color: 0xffff88, magnitude: 0.9 },
                    { name: 'Barnard\'s Star', distance: 400, color: 0xff8888, magnitude: 0.4 },
                    { name: 'Sirius A', distance: 500, color: 0xaaaaff, magnitude: 2.0 },
                    { name: 'Vega', distance: 600, color: 0xbbbbff, magnitude: 1.8 }
                ];

                nearbyStars.forEach(starData => {
                    const geometry = new THREE.SphereGeometry(starData.magnitude, 16, 16);
                    const material = new THREE.MeshBasicMaterial({
                        color: starData.color,
                        emissive: starData.color,
                        emissiveIntensity: 1
                    });
                    const star = new THREE.Mesh(geometry, material);

                    // Random position on sphere at distance
                    const theta = Math.random() * Math.PI * 2;
                    const phi = Math.random() * Math.PI;
                    star.position.x = starData.distance * Math.sin(phi) * Math.cos(theta);
                    star.position.y = starData.distance * Math.sin(phi) * Math.sin(theta);
                    star.position.z = starData.distance * Math.cos(phi);

                    star.name = starData.name;
                    star.userData = {
                        type: 'star',
                        info: {
                            name: starData.name,
                            distance: `${(starData.distance / 100).toFixed(2)} light years`,
                            apparentMagnitude: starData.magnitude
                        }
                    };

                    this.scene.add(star);
                    this.objects.stars.push(star);
                });
            }

            async loadExoplanets() {
                // Simulate exoplanets (normally would fetch from NASA Exoplanet Archive)
                const exoplanets = [
                    { name: 'Kepler-452b', host: 'Kepler-452', radius: 1.6 },
                    { name: 'Proxima Centauri b', host: 'Proxima Centauri', radius: 1.1 },
                    { name: 'TRAPPIST-1e', host: 'TRAPPIST-1', radius: 0.92 }
                ];

                // Add these near their host stars if they exist
                // For demo, we'll just note them in the data
                this.dataCache.exoplanets = exoplanets;
            }

            createOrbits() {
                this.objects.planets.forEach(planet => {
                    if (planet.userData.distance) {
                        const orbitGeometry = new THREE.BufferGeometry();
                        const orbitMaterial = new THREE.LineBasicMaterial({
                            color: 0x404040,
                            transparent: true,
                            opacity: 0.3
                        });

                        const points = [];
                        const segments = 128;
                        for (let i = 0; i <= segments; i++) {
                            const angle = (i / segments) * Math.PI * 2;
                            const x = Math.cos(angle) * planet.userData.distance;
                            const z = Math.sin(angle) * planet.userData.distance;
                            points.push(new THREE.Vector3(x, 0, z));
                        }

                        orbitGeometry.setFromPoints(points);
                        const orbit = new THREE.Line(orbitGeometry, orbitMaterial);
                        orbit.visible = this.showOrbits;
                        this.scene.add(orbit);
                        this.orbits.push(orbit);
                    }
                });
            }

            createLabel(object) {
                // Creating CSS3D labels would be better, but for simplicity using sprites
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.width = 256;
                canvas.height = 64;

                context.font = 'Bold 24px Arial';
                context.fillStyle = 'rgba(255,255,255,0.9)';
                context.textAlign = 'center';
                context.fillText(object.name, 128, 32);

                const texture = new THREE.CanvasTexture(canvas);
                const spriteMaterial = new THREE.SpriteMaterial({
                    map: texture,
                    transparent: true
                });
                const sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(10, 2.5, 1);
                sprite.position.copy(object.position);
                sprite.position.y += object.geometry ? object.geometry.parameters.radius + 2 : 2;
                sprite.visible = this.showLabels;

                this.scene.add(sprite);
                this.labels.push({ sprite, object });
            }

            loadFallbackData() {
                // If APIs fail, load basic demonstration data
                this.loadSolarSystemData();
                this.loadAsteroidData();
                this.createOrbits();
                this.updateObjectCount();
            }

            setupEventListeners() {
                window.addEventListener('resize', () => this.onWindowResize());
                window.addEventListener('mousemove', (event) => this.onMouseMove(event));
                window.addEventListener('click', (event) => this.onMouseClick(event));

                // Search functionality
                document.getElementById('search-input').addEventListener('input', (e) => {
                    this.searchObjects(e.target.value);
                });
            }

            onWindowResize() {
                this.camera.aspect = window.innerWidth / window.innerHeight;
                this.camera.updateProjectionMatrix();
                this.renderer.setSize(window.innerWidth, window.innerHeight);
            }

            onMouseMove(event) {
                this.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                this.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

                // Update tooltip
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects([
                    ...this.objects.planets,
                    ...this.objects.stars,
                    ...this.objects.asteroids
                ]);

                const tooltip = document.getElementById('tooltip');
                if (intersects.length > 0) {
                    const object = intersects[0].object;
                    if (object.name) {
                        tooltip.style.display = 'block';
                        tooltip.style.left = event.clientX + 10 + 'px';
                        tooltip.style.top = event.clientY + 10 + 'px';
                        tooltip.textContent = object.name;
                    }
                } else {
                    tooltip.style.display = 'none';
                }
            }

            onMouseClick(event) {
                this.raycaster.setFromCamera(this.mouse, this.camera);
                const intersects = this.raycaster.intersectObjects([
                    ...this.objects.planets,
                    ...this.objects.stars
                ]);

                if (intersects.length > 0) {
                    const object = intersects[0].object;
                    this.selectObject(object);
                }
            }

            selectObject(object) {
                document.getElementById('selected-object').textContent = object.name || 'Unknown';
                
                // Update info panel with object data
                if (object.userData.info) {
                    const infoPanel = document.getElementById('info-panel');
                    let infoHTML = `<h2>${object.name}</h2>`;
                    
                    for (const [key, value] of Object.entries(object.userData.info)) {
                        const formattedKey = key.charAt(0).toUpperCase() + key.slice(1).replace(/([A-Z])/g, ' $1');
                        infoHTML += `
                            <div class="info-item">
                                <span class="info-label">${formattedKey}:</span> ${value}
                            </div>
                        `;
                    }
                    
                    infoPanel.innerHTML = infoHTML;
                }

                // Smooth camera transition to object
                this.focusOnObject(object);
            }

            focusOnObject(object) {
                const distance = object.geometry ? object.geometry.parameters.radius * 10 : 10;
                const targetPosition = new THREE.Vector3(
                    object.position.x + distance,
                    object.position.y + distance / 2,
                    object.position.z + distance
                );

                // Animate camera movement
                const startPosition = this.camera.position.clone();
                const animationDuration = 2000;
                const startTime = Date.now();

                const animate = () => {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / animationDuration, 1);
                    
                    // Smooth easing
                    const easeProgress = 1 - Math.pow(1 - progress, 3);
                    
                    this.camera.position.lerpVectors(startPosition, targetPosition, easeProgress);
                    this.camera.lookAt(object.position);
                    
                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    }
                };
                animate();
            }

            searchObjects(query) {
                if (!query) return;
                
                const allObjects = [
                    ...this.objects.planets,
                    ...this.objects.stars
                ];
                
                const found = allObjects.find(obj => 
                    obj.name && obj.name.toLowerCase().includes(query.toLowerCase())
                );
                
                if (found) {
                    this.selectObject(found);
                }
            }

            viewSolarSystem() {
                this.camera.position.set(100, 50, 100);
                this.camera.lookAt(0, 0, 0);
                document.getElementById('current-view').textContent = 'Solar System';
            }

            viewGalaxy() {
                this.camera.position.set(500, 200, 500);
                this.camera.lookAt(0, 0, 0);
                document.getElementById('current-view').textContent = 'Galaxy View';
            }

            viewNearbyStars() {
                this.camera.position.set(300, 150, 300);
                this.camera.lookAt(0, 0, 0);
                document.getElementById('current-view').textContent = 'Nearby Stars';
            }

            toggleOrbits() {
                this.showOrbits = !this.showOrbits;
                this.orbits.forEach(orbit => {
                    orbit.visible = this.showOrbits;
                });
            }

            toggleLabels() {
                this.showLabels = !this.showLabels;
                this.labels.forEach(label => {
                    label.sprite.visible = this.showLabels;
                });
            }

            updateObjectCount() {
                const total = 
                    this.objects.planets.length +
                    this.objects.stars.length +
                    this.objects.asteroids.length;
                document.getElementById('object-count').textContent = total;
            }

            animate() {
                requestAnimationFrame(() => this.animate());

                // Rotate planets
                this.objects.planets.forEach(planet => {
                    // Rotation
                    if (planet.userData.rotationSpeed) {
                        planet.rotation.y += planet.userData.rotationSpeed;
                    }
                    
                    // Orbit
                    if (planet.userData.orbitSpeed) {
                        planet.userData.angle += planet.userData.orbitSpeed;
                        planet.position.x = Math.cos(planet.userData.angle) * planet.userData.distance;
                        planet.position.z = Math.sin(planet.userData.angle) * planet.userData.distance;
                    }

                    // Update moon positions
                    planet.children.forEach(child => {
                        if (child.userData && child.userData.type === 'moon') {
                            child.rotation.y += 0.05;
                        }
                    });
                });

                // Rotate asteroids slowly
                this.objects.asteroids.forEach(asteroid => {
                    asteroid.rotation.x += 0.001;
                    asteroid.rotation.y += 0.001;
                });

                // Update labels to follow objects
                this.labels.forEach(label => {
                    if (label.sprite.visible) {
                        label.sprite.position.copy(label.object.position);
                        label.sprite.position.y += 5;
                    }
                });

                // Update controls
                this.controls.update();

                // Update stats
                this.updateStats();

                // Render
                this.renderer.render(this.scene, this.camera);
            }

            updateStats() {
                const stats = document.getElementById('stats');
                stats.innerHTML = `
                    FPS: ${Math.round(1000 / 16.67)}<br>
                    Camera: [${Math.round(this.camera.position.x)}, ${Math.round(this.camera.position.y)}, ${Math.round(this.camera.position.z)}]
                `;
            }
        }

        // Initialize the universe explorer
        let universe;
        window.addEventListener('DOMContentLoaded', () => {
            universe = new UniverseExplorer();
        });
    </script>
</body>
</html>